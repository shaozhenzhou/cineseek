# CineSeek 业务需求说明书

## 文档信息

| 项目名称 | CineSeek - 电影信息搜索系统 |
|---------|---------------------------|
| 文档版本 | 1.0 |
| 编写日期 | 2025-11-02 |
| 编写人 | 开发团队 |
| 审核人 | 项目负责人 |

## 1. 项目背景

### 1.1 项目概述

CineSeek 是一款基于 Wikidata 和 Wikipedia 的电影信息搜索系统,旨在帮助用户快速准确地查找电影信息,特别是从复杂的文件名中解析出电影信息。

### 1.2 项目目标

- **主要目标**:为用户提供快速、准确的电影信息搜索服务
- **核心价值**:
  - 无需依赖商业 API(如 TMDB),完全基于开放数据源
  - 智能解析复杂文件名,提取关键信息
  - 支持中英文搜索和显示
  - 提供丰富的电影元数据(海报、类型、国家等)

### 1.3 目标用户

- **主要用户群体**:
  - 电影资源管理者:需要整理和标注大量电影文件
  - 影视爱好者:希望快速查询电影详细信息
  - 媒体服务器用户:需要自动化电影元数据获取
  - 开发者:需要集成电影搜索功能的应用开发者

### 1.4 使用场景

1. **文件名解析**:用户拥有大量带有编码、分辨率等标记的电影文件,需要快速识别电影信息
2. **电影信息查询**:用户想要查询电影的详细信息,包括年份、类型、国家等
3. **海报获取**:用户需要获取电影的海报图片用于媒体库展示
4. **批量处理**:用户需要批量处理大量电影文件,自动获取元数据

## 2. 业务需求

### 2.1 功能需求概述

| 需求编号 | 需求名称 | 优先级 | 说明 |
|---------|---------|-------|------|
| FR-001 | 智能文件名解析 | 高 | 解析包含编码、分辨率等标记的复杂文件名 |
| FR-002 | 电影信息搜索 | 高 | 基于 Wikidata 搜索电影信息 |
| FR-003 | 年份过滤 | 高 | 根据解析出的年份过滤搜索结果 |
| FR-004 | 繁简转换 | 中 | 支持中文繁简体自动转换搜索 |
| FR-005 | 海报获取 | 中 | 从 Wikimedia Commons 获取电影海报 |
| FR-006 | 搜索历史 | 中 | 记录和管理用户搜索历史 |
| FR-007 | 多结果展示 | 高 | 展示多个搜索结果供用户选择 |
| FR-008 | 维基百科链接 | 低 | 提供中英文维基百科词条链接 |

### 2.2 详细功能需求

#### 2.2.1 智能文件名解析(FR-001)

**业务描述**:
用户输入的电影文件名通常包含大量技术标记(如分辨率、编码格式、音轨信息等),系统需要智能识别并提取核心电影名称和年份信息。

**输入示例**:
- `White.House.Down.2013.1080p.BluRay.DTS-HD.MA.5.1.x264-PublicHD`
- `变形金刚2007.1080p.BluRay.x264`
- `我是传奇(蓝光国英双音轨...).I.Am.Legend.2007.2160p.HDR`

**预期输出**:
- 电影名称: `White House Down` / `变形金刚` / `我是传奇`
- 年份: `2013` / `2007` / `2007`

**业务规则**:
1. 优先使用 guessit 库进行解析
2. 支持中英文混合文件名
3. 自动过滤常见噪声标记(分辨率、编码、音轨等)
4. 支持从括号中提取年份
5. 年份范围限制为 1900-2100

#### 2.2.2 电影信息搜索(FR-002)

**业务描述**:
基于解析出的电影名称,在 Wikidata 中搜索匹配的电影条目,返回详细的电影元数据。

**数据来源**:
- 主数据源: Wikidata SPARQL 查询服务
- 辅助数据源: Wikipedia、Wikimedia Commons

**返回信息**:
- 基础信息:中文标题、英文标题、年份
- 元数据:类型、制片国家/地区
- 扩展信息:海报 URL、维基百科链接、Wikidata ID

**业务规则**:
1. 优先匹配中文标题
2. 同时搜索英文标题和别名
3. 支持繁简体自动转换
4. 返回最多 10 个候选结果
5. 超时时间设置为 15 秒

#### 2.2.3 年份过滤(FR-003)

**业务描述**:
当文件名中包含年份信息时,对搜索结果进行智能过滤,提高匹配准确度。

**业务规则**:
1. 允许 ±1 年的误差范围
2. 年份匹配的结果优先排序
3. 如果有年份匹配的结果,仅返回年份匹配的结果
4. 按年份匹配度排序(精确匹配 > ±1 年 > 无年份)

#### 2.2.4 繁简转换(FR-004)

**业务描述**:
自动处理中文繁简体转换,提高搜索的覆盖率。

**业务规则**:
1. 使用 OpenCC 进行繁简转换
2. 同时搜索简体和繁体标题
3. 结果中保留原始标题和转换后的标题

#### 2.2.5 海报获取(FR-005)

**业务描述**:
从 Wikimedia Commons 获取电影官方海报图片。

**业务规则**:
1. 优先获取官方海报(标记为 poster)
2. 如无海报,提供占位图
3. 返回高质量图片 URL
4. 支持懒加载

#### 2.2.6 搜索历史(FR-006)

**业务描述**:
记录用户的搜索历史,方便快速重复搜索。

**业务规则**:
1. 最多保存 10 条历史记录
2. 去重:相同搜索词不重复记录
3. 最新搜索置顶
4. 支持点击历史记录快速搜索
5. 支持一键清除所有历史
6. 使用 localStorage 持久化存储

### 2.3 非功能需求

#### 2.3.1 性能需求

| 指标 | 要求 |
|-----|------|
| 响应时间 | API 响应时间 < 3 秒(90% 的请求) |
| 并发处理 | 支持至少 100 个并发请求 |
| 搜索超时 | Wikidata 查询超时 15 秒 |
| 前端加载 | 首屏加载时间 < 2 秒 |

#### 2.3.2 可用性需求

- **系统可用性**: ≥ 99%
- **容错能力**: Wikidata 服务不可用时,返回友好错误信息
- **降级策略**: guessit 不可用时,自动降级到正则解析

#### 2.3.3 兼容性需求

- **浏览器支持**:
  - Chrome/Edge 90+
  - Firefox 88+
  - Safari 14+
- **操作系统**:
  - Windows 10/11
  - macOS 11+
  - Linux(主流发行版)
- **Python 版本**: Python 3.10+

#### 2.3.4 安全性需求

- **CORS 配置**: 开发环境允许所有来源,生产环境限制域名
- **输入验证**: 对用户输入进行基本验证,防止注入攻击
- **API 限流**: 防止恶意请求(未来考虑)

#### 2.3.5 可维护性需求

- **代码规范**: 遵循 PEP 8(Python)和 Vue 3 风格指南
- **文档完整**: 提供完整的 API 文档和开发文档
- **日志记录**: 记录关键操作和错误信息
- **测试覆盖**: 核心功能单元测试覆盖率 ≥ 80%

## 3. 业务流程

### 3.1 电影搜索流程

```
开始
  ↓
用户输入文件名
  ↓
前端发送搜索请求
  ↓
后端接收请求
  ↓
智能解析文件名
  ├─ 使用 guessit 解析
  └─ 正则表达式解析(降级)
  ↓
提取电影名称和年份
  ↓
Wikidata SPARQL 查询
  ├─ 中文标题搜索
  ├─ 英文标题搜索
  └─ 繁简转换搜索
  ↓
年份过滤(如果有年份)
  ↓
获取扩展信息
  ├─ 海报 URL
  ├─ 维基百科链接
  └─ 类型、国家等元数据
  ↓
返回搜索结果(最多 5 个)
  ↓
前端展示结果
  ├─ 显示海报
  ├─ 显示电影信息
  └─ 提供维基百科链接
  ↓
保存到搜索历史
  ↓
结束
```

### 3.2 搜索历史管理流程

```
开始
  ↓
页面加载
  ↓
从 localStorage 读取历史
  ↓
用户执行搜索
  ↓
搜索成功?
  ├─ 是 → 添加到历史列表
  │         ├─ 去重(移除已存在的相同记录)
  │         ├─ 插入到列表开头
  │         └─ 限制最多 10 条
  └─ 否 → 不添加
  ↓
保存到 localStorage
  ↓
用户点击输入框
  ↓
显示历史面板
  ↓
用户操作
  ├─ 点击历史项 → 填充输入框并搜索
  ├─ 点击清除按钮 → 清空所有历史
  └─ 点击外部 → 关闭历史面板
  ↓
结束
```

## 4. 数据需求

### 4.1 数据来源

| 数据类型 | 来源 | 说明 |
|---------|------|------|
| 电影基础信息 | Wikidata | 标题、年份、类型等 |
| 电影海报 | Wikimedia Commons | 官方海报图片 |
| 维基百科链接 | Wikipedia | 中英文词条链接 |
| 搜索历史 | localStorage | 本地存储 |

### 4.2 数据模型

#### 电影基础信息(MovieResult)
```
- fullname: 完整名称
- name: 中文名称
- originalName: 英文原名
- year: 年份
- genre: 类型
- country: 制片国家/地区
- alias: 又名
```

#### 电影扩展信息(MovieResultExtended)
```
- wikidata_id: Wikidata ID
- title_cn: 中文标题
- title_en: 英文标题
- year: 年份
- display_title: 显示标题
- genres: 类型列表
- countries: 国家列表
- poster_url: 海报 URL
- wikipedia_links: 维基百科链接(中文/英文)
```

## 5. 界面需求

### 5.1 页面结构

- **顶部标题区**: 显示项目名称和简介
- **搜索区**: 输入框 + 搜索按钮
- **历史面板**: 下拉显示搜索历史
- **结果展示区**: 卡片式网格布局
- **底部信息**: 版权信息

### 5.2 交互要求

- **响应式设计**: 适配桌面和移动设备
- **实时反馈**: 搜索过程中显示加载状态
- **错误提示**: 搜索失败时显示友好错误信息
- **键盘支持**: 支持 Enter 键提交搜索
- **焦点管理**: 输入框获得焦点时显示历史

### 5.3 视觉风格

- **主题**: 深色科技风格
- **配色**: 深蓝色背景 + 亮蓝色强调
- **字体**: 系统默认 sans-serif
- **动画**: 平滑过渡效果

## 6. 约束条件

### 6.1 技术约束

- 必须使用 Python 3.10+ 和 FastAPI 框架
- 前端必须使用 Vue 3 和 Vite
- 数据源限定为 Wikidata 和 Wikipedia
- 不使用商业 API(如 TMDB)

### 6.2 外部依赖

- **网络依赖**: 依赖 Wikidata SPARQL 服务可用性
- **库依赖**: guessit、opencc、httpx 等第三方库

### 6.3 法律约束

- 遵守 Wikidata 和 Wikipedia 的使用条款
- 海报图片遵循 Wikimedia Commons 的版权规定
- 开源协议: MIT License

## 7. 风险评估

### 7.1 技术风险

| 风险 | 可能性 | 影响 | 应对措施 |
|-----|-------|------|---------|
| Wikidata 服务不可用 | 低 | 高 | 实现错误处理和降级策略 |
| guessit 解析失败 | 中 | 中 | 提供正则表达式降级方案 |
| 海报获取失败 | 中 | 低 | 提供占位图 |
| 并发性能问题 | 低 | 中 | 使用异步处理 |

### 7.2 业务风险

| 风险 | 可能性 | 影响 | 应对措施 |
|-----|-------|------|---------|
| 搜索准确度不足 | 中 | 高 | 优化解析算法和搜索策略 |
| 用户体验不佳 | 低 | 中 | 持续收集用户反馈优化 |
| Wikidata 数据不完整 | 中 | 中 | 接受限制,说明数据来源 |

## 8. 验收标准

### 8.1 功能验收

- [ ] 能够正确解析 90% 以上的常见电影文件名
- [ ] 搜索结果准确率 ≥ 85%
- [ ] 所有核心功能正常运行
- [ ] 搜索历史功能完整可用

### 8.2 性能验收

- [ ] API 响应时间符合要求
- [ ] 前端加载速度符合要求
- [ ] 支持目标并发量

### 8.3 质量验收

- [ ] 无严重 bug
- [ ] 代码通过 lint 检查
- [ ] 核心功能测试覆盖率 ≥ 80%
- [ ] 文档完整

## 9. 交付物

1. **源代码**: 完整的前后端源代码
2. **部署包**: 可直接部署的构建产物
3. **文档**:
   - 用户使用文档(README.md)
   - API 接口文档
   - 开发者文档
   - 部署文档
4. **测试报告**: 测试用例和测试结果

## 10. 项目里程碑

| 阶段 | 时间 | 交付物 |
|-----|------|-------|
| 需求分析 | Week 1 | 需求说明书 |
| 设计阶段 | Week 2 | 概要设计、详细设计 |
| 开发阶段 | Week 3-4 | 后端 API + 前端界面 |
| 测试阶段 | Week 5 | 测试报告 |
| 部署上线 | Week 6 | 生产环境部署 |

## 11. 附录

### 11.1 术语表

- **Wikidata**: 维基媒体基金会的开放知识图谱数据库
- **SPARQL**: 用于查询 RDF 数据的查询语言
- **guessit**: Python 的媒体文件名解析库
- **OpenCC**: 开源的中文繁简转换库
- **FastAPI**: 现代、快速的 Python Web 框架
- **Vue 3**: 渐进式 JavaScript 框架

### 11.2 参考资料

- Wikidata Query Service: https://query.wikidata.org/
- Wikipedia API: https://www.wikipedia.org/api/
- Wikimedia Commons: https://commons.wikimedia.org/
- guessit 文档: https://guessit.readthedocs.io/
- FastAPI 文档: https://fastapi.tiangolo.com/
- Vue 3 文档: https://vuejs.org/

---

**文档状态**: ✅ 已完成  
**最后更新**: 2025-11-02  
**版本历史**: v1.0 - 初始版本
